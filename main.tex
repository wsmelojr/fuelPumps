% Middleware 2017 -- Sample Latex submission style

%\documentclass[sigplan, anonymous]{acmart}
\documentclass[sigplan]{acmart}

\usepackage{booktabs} % For formal tables

% Copyright
%\setcopyright{none}
%\setcopyright{acmcopyright}
%\setcopyright{acmlicensed}
% \setcopyright{rightsretained}
%\setcopyright{usgov}
%\setcopyright{usgovmixed}
%\setcopyright{cagov}
%\setcopyright{cagovmixed}

% DOI
% \acmDOI{10.475/123_4}

% ISBN
% \acmISBN{123-4567-24-567/08/06}

%Conference
\acmConference[Middleware'19]{ACM/IFIP/USENIX Middleware}{Dec 2019}{UC Davis, California, USA} 
%\acmYear{2019}
%\copyrightyear{2018}
% \acmPrice{15.00}

% \acmBadgeL[http://ctuning.org/ae/ppopp2016.html]{ae-logo}
% \acmBadgeR[http://ctuning.org/ae/ppopp2016.html]{ae-logo}

\hypersetup{draft}
\begin{document}
\title{Field Surveillance using Blockchains: \\a Study Case regarding Fuel Dispensers in Brazil}

\author{Wilson Melo Jr., Luiz Rust Carmo, \\Luiz Tarelho, Bruno Rodrigues Filho}
\affiliation{%
  \institution{National Institute of Metrology, Quality and Technology}
  %\streetaddress{1 Th{\o}rv{\"a}ld Circle}
  \city{Duque de Caxias - RJ} 
  %\state{RJ}
  \country{Brazil}}
\email{{wsjunior,lfrust,lvtarelho,bafilho}@inmetro.gov.br}

\author{Alysson Bessani}
\affiliation{%
  \institution{LaSIGE, Faculdade de Ci\^encias\\}
  %\streetaddress{P.O. Box 1212}
  \city{Universidade de Lisboa} 
  \country{Portugal} 
  %\postcode{43017-6221}
}
\email{bessani@fc.ul.pt}

%\author{Luiz F. R. C. Carmo}
%\orcid{1234-5678-9012}
%\affiliation{%
%  \institution{Federal University of Rio de Janeiro\\}
  %\streetaddress{P.O. Box 1212}
%  \city{Rio de Janeiro} 
%  \state{RJ}
%  \country{Brazil}
  %\postcode{43017-6221}
%}
%\email{rust@nce.ufrj.br}


% The default list of authors is too long for headers}
\renewcommand{\shortauthors}{W. Melo Jr et al.}

\begin{abstract}
Metrological supervision is one of the main activities in the context of legal metrology that assures the correct behavior of a measuring instrument.
In all the world, the metrological surveillance of fuel dispensers (or fuel pumps) placed in the market (i.e., field surveillance) constitutes a complex challenge.
Malicious entities can tamper with these measuring instruments to get undue economic advantages.
This practice is particularly common in developing countries where authorities have difficulty in inspecting all the instruments that are typically spread in large geographic areas.   
In this paper, we propose a distributed and decentralized framework that uses vehicles as sensors to implement the field surveillance.
Although vehicles usually do not embed a precise and accurate fuel meter, they can provide measurement estimates.
We use a large number of these estimates to inspect fuel dispensers behavior, by exploring the properties of the well known Law of the Large Numbers.
We also propose the use of blockchains to provide a truly distributed and decentralized surveillance solution and implement different statistical surveillance heuristics using smart contracts.
Furthermore, we develop a case study that uses the Hyperledger Fabric platform to implement and test our idea in a complete blockchain network.
We simulate the transactions workload by using statistic information from real metrological inspections of fuel dispensers in Brazil.
The detection of fraudulent behavior consists of a smart contract implementing a very simple analysis heuristic that detects outlier measurements.
The results attest our framework suitability and provide promising perspectives on the use of our idea in the metrological surveillance of different measurement instruments.
\end{abstract}

%
% The code below should be generated by the tool at
% http://dl.acm.org/ccs.cfm
% Please copy and paste the code instead of the example below. 
%
% \begin{CCSXML}
% <ccs2012>
%  <concept>
%   <concept_id>10010520.10010553.10010562</concept_id>
%   <concept_desc>Computer systems organization~Embedded systems</concept_desc>
%   <concept_significance>500</concept_significance>
%  </concept>
%  <concept>
%   <concept_id>10010520.10010575.10010755</concept_id>
%   <concept_desc>Computer systems organization~Redundancy</concept_desc>
%   <concept_significance>300</concept_significance>
%  </concept>
%  <concept>
%   <concept_id>10010520.10010553.10010554</concept_id>
%   <concept_desc>Computer systems organization~Robotics</concept_desc>
%   <concept_significance>100</concept_significance>
%  </concept>
%  <concept>
%   <concept_id>10003033.10003083.10003095</concept_id>
%   <concept_desc>Networks~Network reliability</concept_desc>
%   <concept_significance>100</concept_significance>
%  </concept>
% </ccs2012>  
% \end{CCSXML}

% \ccsdesc[500]{Computer systems organization~Embedded systems}
% \ccsdesc[300]{Computer systems organization~Redundancy}
% \ccsdesc{Computer systems organization~Robotics}
% \ccsdesc[100]{Networks~Network reliability}

% We no longer use \terms command
%\terms{Theory}

% \keywords{ACM proceedings, \LaTeX, text tagging}

\maketitle

\section{Introduction}
Fuel dispensers (or fuel/petrol pumps) are measuring instruments which play a crucial role in the trading of fuel as a consumable good.
In most places in the world, fuel stations and consumers trade fuel based on measurements given by fuel dispensers.
The transaction relies on the assumption that the fuel dispenser is a precise, accurate and reliable measuring instrument.
Directives promoted by regulatory agencies and metrological supervision activities introduced by legal metrology are often employed for assuring such assumption \cite{RodriguesFilho2015}.
However, in practice, evidence points that frauds against fuel dispensers are a growing and widespread practice, especially in developing countries \cite{Luchsinger2008,Leitao2014a,Beteto2016,RodriguesFilho2016}.
One of the most common fraud is known as "low pump," and it occurs when the fuel dispenser delivers a fuel amount lower than the informed to the consumer \cite{Beteto2016}.
Such practice affects an expressive percent of trade transactions, resulting in significant economic losses for all the society \cite{RodriguesFilho2016}.

The main problem associated with such frauds is the difficulty in proceeding with metrological surveillance activities.
Although legal metrology usually designates notified bodies for inspecting fuel dispensers, these activities are not sufficiently efficient \cite{MeloJr.2019}.
The high number of instruments spread over extensive geographic areas constitutes a challenge in terms of logistics and inspection costs.
Also, many frauds employ sophisticated mechanisms that explore electronics and software features of the fuel dispenser \cite{Leitao2014a}.
These mechanisms can be activated and deactivated automatically, making fraudulent behavior stealthy and hard to detect.
Although there are several entities interested in solutions against such cheating (e.g., honest fuel station owners, fuel manufacturers, regulation agencies, and civil representatives) \cite{Beteto2016,Oppermann2018}, these frauds are very profitable.
That increases the chance of collusion among dishonest fuel vendors and entities which could expose this fraudulent practice.

In this work, we propose a distributed and decentralized surveillance solution to deal with fraudulent fuel dispensers.
Our idea consists of using vehicles as sensors that perform an additional measuring of fuel in each refuel event and make this information available in a distributed data storage.
Although vehicles embedded meters can be imprecise and inaccurate, the information collected by a large number of vehicles can indicate fraudulent behavior in fuel dispensers.
%We demonstrate the statistical conditions that must be satisfied for reaching such results.
Besides, we propose the use of permissioned blockchains \cite{Vukolic2016} to store information in a distributed way.
Blockchains are a truly distributed append-only data structure that assures information integrity while enables automatized workflows by implementing self-executable code (i.e., smart contracts) \cite{Christidis2016}.
Once we have different stakeholders interested in preventing frauds in fuel dispensers, their effort in maintaining a blockchain for metrological surveillance constitutes a robust solution against collusion agreements \cite{MeloJr.2019}.

The main contributions in this paper are the following:
\begin{itemize}
 \item We present a statistical approach to perform field surveillance using measuring instruments whose uncertainty is unknown. That is an interesting result with several applications in the legal metrology field. We validate our method by simulating refuel events based on real data from metrological supervision activities and inspections.
 \item We propose a \textit{Distributed and Decentralized Surveillance Framework} (DDSF) and instantiate it in two implementation models: the regulated and the free surveillance schemes. We give particular attention to the free model, where vehicles can contribute to field surveillance actively and spontaneously. We also discuss the available technologies for obtaining fuel measurements from a vehicle's tank in refueling events.
 \item We proceed with the security analysis of the proposed solution. We show its main advantages and drawbacks, pointing out security techniques for preventing attacks while increasing protection.
 \item We describe and implement a case study that instantiates our framework to meet the demand from fuel dispensers surveillance in Sao Paulo state, Brazil. We use the HyperLedger Fabric blockchain platform to store measurements from fuel dispensers and vehicles. We also implement a surveillance strategy using smart contracts.
 Finally, we present an experiment that evaluates both the surveillance strategy efficiency and the blockchain performance.
\end{itemize}
% \subsection{Topics}
% 
% \begin{itemize}
% \item Measurement frauds in fuel dispensers are very common.
% 
% \item They are more frequent in developing countries.
% 
% \item The costs associated to the prejudice of the society is estimated in \cite{RodriguesFilho2016}.
% 
% \item Although that is a serious problem, research works proposing security approaches and alternatives are scarce.
% 
% \item The majority of ideas are associated with patents and proprietary alternatives which the use is not spread out.
% 
% \item When we consider metrological authorities, ideas concerning product improvement or the use of information technology can make the difference.
% 
% \end{itemize}


% \subsection{Text Introduction}
% 
% Frauds against fuel dispensers or fuel pumps are widespread in developing countries.
% A tampered fuel pump usually delivers less fuel than the measured value informed to the client \cite{Luchsinger2008,Leitao2014,Leitao2014a,Beteto2016,RodriguesFilho2016}.
% We propose a metrological surveillance strategy based on additional measurements obtained from the vehicles' embedded computer (VEC).
% Although VEC measurements do not have metrological precision, we can use the unprecise measurements done by several vehicles to infer something about the fuel pump reliability.
% So we need a system that collects fuel measurements from vehicle in the refilling moment. Such information is kept together the metrological measurement obtained from the fuel pump.
% Such information is stored in a blockchain.
% Thus we assure its immutability, at the same time that we create a public environment for entities that want to implement data fraud analyses.
% 
% 
% The implementation of such systems needs to address some challenges:
% \begin{enumerate}
%  \item How can we be sure that VEC measurements come from the respective refilled vehicle?
%  \item How can this information be stored securely?
%  \item How can analysis inferences be implemented to detect a tampered fuel pump?
% \end{enumerate}
% 
% The problem can be described as follows. 
% We have a measuring instrument M whose the measurement uncertainty is a known value $I_M$.
% This instrument is under metrological control, which implies regulation and metrological supervision. 
% However, an attacker can tamper the instrument or even this measurements, compromising their accuracy and reliability.
% 
% Now, we assume we have a second measurement instrument N whose the measurement uncertainty $I_N$ is unknown.
% By comparing the measurements of each instrument, we cannot claim anything about the tampering of the first one. 
% However, it this same comparison is made using several instruments for different measurements...


% \subsection{Mind map for helping}
% We have a mind map in \emph{\href{https://mm.tt/973673423?t=Qtl0EQxNp2}{https://mm.tt/973673423?t=Qtl0EQxNp2}}. Everybody are invited to change and improve it to help the work.
% 
% \subsection{Create new sessions as necessary}
% Any new session (even a temporary one) can be created in this template. References shall be added in the file paper.bib, using bibtex format e referenced in the text as follows: \cite{Peters2015}.
% 
% One can make several citations together \cite{Zhang2016,Beteto2013,Beteto2016,RodriguesFilho2016,Luchsinger2008}.


\section{Preliminaries}

\subsection{Legal Metrology}

Legal metrology is responsible for the control of instruments that impact both the economy and society \cite{RodriguesFilho2015}.
Due to regulation, countries established all the necessary levels of control regarding measuring instruments, especially in measurements where one or both parts have no means to check the accuracy of the measurement. 
Consequently, legal metrology acts as a third party assessor to make a measurement reliable.
Fuel dispensers are usually under the control of legal metrology since they have an important impact on every country's economy. The levels of control in legal metrology can be described as \cite{VIM2012}:

\begin{enumerate}
 \item Legal control of measuring instruments, which comprises the stages represented by type approval and both initial and subsequent verification of devices used on the market;
 \item Metrological supervision, which are activities aiming to check the accordance of devices to metrology laws and regulations, and includes market and field surveillance;
 \item The operations comprising examination and demonstration of conformity to a court for legal penalties, previously known as metrological expertise.
\end{enumerate}

Despite the legal metrology levels of control, the instruments are always subjective to metrological frauds, where the seller intentionally influence the performance of the instrument,  impacting in its accuracy due to a component of uncertainty against the buyer. 
In the fuel market, a simulation showed that for a 10 percent volume fraud and 1 percent fraudulent devices on the market, the economic losses are represented by approximately USD 300 million per year \citep{RodriguesFilho2016}. 
Another important aspect of frauds also relies on unfair competition to the business that does not apply fraudulent procedures.

In all the world, legal metrology is looking for tools and technologies to improve its activities.
One interesting example is the \emph{Metrology Cloud} initiative from Europe Union \cite{Oppermann2018}.
This is a long term project that proposes the integration of different legal metrology services in a secure cloud computing architecture.
These services shall include the managing of legal processes, measurements storage, monitoring systems, logging of legally relevant activities and even the execution of legally relevant software in the cloud.
In Brazil, information technologies and management systems also have been applied to legal metrology successfully, increasing the efficiency of processes regarding all levels of action \cite{RodriguesFilho2015a}.
These tools optimize the allocation of resources in legal control.
Furthermore, they also bring conformity and measurement assurance to the economy, promoting fair trading to society.

On the other hand, the usage of new technologies also raises still unknown issues, especially in legal metrology.
These issues include concerns about security and privacy.
They demand strategies to prevent the fraudulent use of personal information, for instance.
% Traditional security systems have been showing to be a failure when working in connected and interactive networking.
%  (i.e., as in a smart city context \cite{Biswas2016}, and the blockchain technology has been applied to surpass the security aspect.

\subsection{Technologies for Fuel Measurement}
\subsubsection{How fuel dispensers work}
An electronic fuel dispenser pumps the fuel from an underground tank passing into a measurement transducer, responsible for the measurement, throughout the nozzle, under the control of a solenoid valve, to the car tank.
The measurement transducer is typically represented by a mechanical axis integrated to a \textit{pulser}, where the movement of the axis is converted to electronic pulses.
Consequently, the number of pulses is proportional to the measured volume.
Figure \ref{f:transducer} shows a measurement transducer illustration, as well as a typical fuel dispenser measurement transducer.

\begin{figure}[!t]
\centering
\includegraphics[width=.45\textwidth]{transducer}
\caption{Principle of a measurement transducer and a real device (adapted from \cite{Leitao2014a}).}
\label{f:transducer}
\end{figure}

Fuel dispensers are subject to subsequent verification, i.e., they are periodically tested and compared to volume standards by applying procedures based on the general recommendations issued by the International Organization of Legal Metrology, OIML. 
They are also subject of metrological surveillance, where the equipment is inspected randomly on the field, checking the accordance with the legal requirements.
According to the OIML International Recommendation \cite{OIML2007}, the accuracy test comprises in testing the instrument in different flow rates using a standard capacity measure.
% For example, in Brazil, the test follows the recommendation of using a 20 liters standard, and the maximum permissible error is 0.5 percent, for both maximum and minimum flow rate.
The devices that do not fulfill the requirements are rejected and shall be removed from use.

\subsubsection{Measuring fuel in vehicles}
\label{s:vmftech}
Fuel amount estimation is an important requirement in different applications related to vehicles \cite{Skog2014,Obikoya2014,Andria2016,Kumar2017,Ahmed2017,Patil2017}.
We find such examples in telemetry, driver evaluation, fleet monitoring, and fuel thief prevention, among others.
In the majority of countries, it is mandatory that vehicles exhibit the fuel measurement to the driver.
The main reason is for preventing drivers from running out of fuel.
Vehicles do that using different instruments, from simple analogic fuel gauges to modern digital displays embedded in the vehicle's panel.
Some vehicle models also use fuel measurements to improve engine performance \cite{Skog2014}.
However, most of the times, such embedded measuring instrument is not designed to be precise or accurate.
Thus these properties depend on the technologies used for measuring the fuel.

Level sensors are the most common technology behind vehicles' fuel measuring instruments \cite{Obikoya2014}.
There are also more sophisticated instruments that use ultrasound sensors or other non-intrusive technologies \cite{Ahmed2017,Patil2017}.
In industry, the decision about which technology to use is usually price-oriented.
Even so, recent works proposing low-cost vehicles' fuel meters report measuring errors no higher than 5\% \cite{Obikoya2014,Ahmed2017,Kumar2017,Patil2017}.

An important question is how one can collect the vehicle's fuel measurements.
OBD (Onboard Diagnostics) Protocol is an alternative for obtaining information from vehicle's embedded sensors \cite{Andria2016}.
OBD interfaces have been a mandatory requirement in vehicles produced in the USA and Europe for the last 15 years.
Nowadays, one can easily obtain low-cost OBD monitoring devices on the Internet by less than U\$ 10\footnote{https://www.amazon.com/s?k=obd2+wireless}.
They can automatize information gathering from the vehicle by reading any available diagnosis information, including fuel measurements.
Smart sensors with communication features are also a suitable solution.
That enables the sensor to send fuel measurements directly to a monitoring application.
Ahmed et al. \cite{Ahmed2017} gives an example of this approach.

\subsection{Blockchains}
Blockchain is an emerging technology which has called the attention of stakeholders in different industry segments. 
Initially associated to crypto-currency markets due to Bitcoin popularity \cite{Zheng2017}, blockchain-based architectures have been proposed for a comprehensive set of application areas including sensors networks, internet of things, smart cities, among others \cite{Zheng2017,Androulaki2018}.
Recently, legal metrology was also pointed out as a potential area to develop blockchain-based solutions \cite{Peters2018,MeloJr.2019}.
%become one of the most promising technologies for the next generation of Internet interaction systems, such as smart contracts, public services, Internet of Things (IoT), reputation systems and security services

Conceptually, one can regard a blockchain as a distributed append-only data structure (designated as \emph{ledger}) which is replicated and shared among a set of network peers \cite{Christidis2016}. 
This structure consists of a sequence of blocks where block $n$ is cryptographically linked to the block $n-1$ using a hash function. 
Consequently, block $n$ cannot be changed without also modifying all subsequent blocks $n + i, ..., n + k$ \cite{Sousa2018}. 
%Being a decentralized model, blockchains availability does not depend on third parties, which can greatly save costs \cite{Zheng2017}.
By avoiding central points of control, blockchains availability does not depend on third parties, which can significantly save costs \cite{Zheng2017}.
In turn, integrity and availability are ensured by consensus among the peers, preventing the whole chain from being modified and requiring an agreement about any block to be appended to the ledger \cite{Sousa2018,Vukolic2016}. 
A blockchain can virtually store any digital asset, from data to self-executing scripts, usually defined as \emph{smart contracts}. 
%Ethereum \cite{Christidis2016} is probably the most well-known blockchain implementation supporting that. 
That makes blockchain not only a data storage architecture but also a complete distributed platform for automated workflow \cite{Christidis2016}. 
%Once every network peer execute the smart contracts independently and automatically, software integrity is achieved from blockchains integrity as a whole. 
%Such property has a remarkable impact on applications that requires software identification and integrity checking.

Blockchain platforms can be classified as \emph{permissionless} when anybody can join to the network and participate in the network consensus, or \emph{permissioned} when consensus is achieved by a set of known and identifiable peers \cite{Vukolic2016,Androulaki2018}. 
Usually, permissioned blockchains consensus protocols expend less computational resources and can reach better transaction latency and throughput \cite{Sousa2018}.
%REMOVIDO: One can say that blockchain enables trustless networks while using public key cryptographic for providing confidentiality and authenticity. 

Hyperledger Fabric is an example of an open source platform for implementing permissioned blockchains \cite{Androulaki2018}.
It provides a flexible architecture that accomodates different mechanisms to implement consensus and validation of transactions \cite{Sousa2018}.
Fabric also supports smart contracts (called chaincodes).
Besides, Fabric can deal with more than 2,000 transactions per second \cite{Androulaki2018}, being until this moment one of the best available blockchain platforms in terms of performance.

%\subsection{Physical Context-based Authentication}
%Physical context-based authentication is a security strategy that uses physical context information shared among different entities to reinforce authentication process \cite{MeloJr.2018}.
%Such mechanism can be used in two-factor authentication, being helpful to protect against external attacks (i.e., attackers which are not able to describe the specific physical context).
%The basic idea is that entities describing a same physical event can use such information to generate a unique identifier.
%In turn, this identifier can attest co-location and simultaneity among the entities.
%It also can be used to generate shared secret keys for establishing a secure communication channel among authenticated entities.

%\subsection{Methods for Data Analysis}
%Principal Component Analysis (PCA) is the fundamental method and most commonly applied statistical procedure that uses an orthogonal transformation to convert a set of observations of possibly correlated variables into a set of values of linearly uncorrelated variables called "principal components" \cite{Peters2015}. The first principal component (PC) is defined by the spectral profile (loading) in the data which describes most of the variation and the second PC is the profile describing the second most of the variation orthogonal to the first and so on. The PC's are composed of so called scores and loadings. Scores and loadings have information about samples and variables, respectively, since they are analyzed together. Variation in the data which is not explained by the model is described in the residuals. The purpose of PCA is data reduction, facilitating an exploratory analysis.
%Hierarchical cluster analysis (HCA) is an unsupervised technique for solving classification problems. HCA is a method of cluster analysis which seeks to build a hierarchy of clusters, commonly used in data mining and statistics. Its aim is to sort cases into clusters such that the degree of association is strong between members of the same cluster and weak between members of different clusters. In general, there are many choices of cluster analysis methodology. One of the the clustering method defines the cluster distance between two clusters to be the maximum distance between their individual components. At every stage of the clustering process, the two nearest clusters are merged into a new cluster. The process is repeated until the whole data set is agglomerated into one single cluster.
%The support vector machines (SVM) is a supervised technique for solving classification problems based on the statistical learning theory and is applied to machine learning. SVMs are supervised learning models with associated learning algorithms that analyze data used for classification and regression analysis. When used for classification the method simultaneously minimizes the empirical error of classification and maximize the separation margin between classes using an optimal separation hyperplane, leading to an unique solution. One of the major features of SVC models is that they can operate in a kernel induced feature space allowing non-linear modeling and good generalization performance is obtained even with relatively small datasets. These characteristics can provide a better performance of SVC in relation to algorithms like as PCA and HCA.

% \section{Attack model}
% In a typical scenario involving vehicles and fuel dispensers, we assume that an attacker aims to get undue economic advantages by tampering the fuel measurements.
% Initially, one can consider any one of the parts involved in the commercial transaction as suspicious.
% However, in a simplified manner, we identify malicious drivers and fuel vendors as potential attackers.
% Malicious fuel vendors take advantage from cases when the fuel measurement is higher than the correct value.
% In opposite, a fuel measurement lower than the correct amount benefits malicious drivers. 
% 
% A malicious fuel vendor is expected to be more resourceful attacker. That happens because he is the formal owner of the devices used in the commercial transaction (e.g., fuel dispenser, payment systems).
% The fuel vendor can control and modify the devices features, compromising the measurements accuracy.
% 
% Malicious drivers also can tamper with measurements.
% However, they are limited when compared to fuel vendors.
% Although the driver has total control over the vehicle measuring system, it is the fuel dispenser which rules the commercial transaction.
% Any tampered measurement coming from the vehicle does not result in economic advantages.
% It is possible to consider individual cases where the driver hacks the fuel dispenser or the payment system.
% Even so, these are exceptional cases once these devices usually do not implement use cases that can be explored in such manner.
% 
% Alternatively, drivers can cheat with the vehicle measurement, aiming to create false suspicions about the fuel dispenser accuracy.
% Such attack succeeds only with collusion among a significative number of vehicles.
% Collusion attacks are typically expensive.
% Also, they do not result in economic advantages in this particular case.
% A more reasonable approach is forging false refueling events.
% The malicious driver generates a measurement by simulating a refuel. 
% After he notifies the surveillance, claiming that the fuel station did not report the event.
% We discuss that specific attack condition in a further section.
% 
% Due to the discussed aspects, we consider the attacker as malicious fuel vendors with the following capabilities:
% \begin{itemize}
%  \item The attacker can compromise the fuel dispenser measurement mechanism.
%  \item The attacker can modify electrical components in the fuel dispenser, consequently changing its measurement features.
%  \item The attacker can inject malicious software into the fuel dispenser, also compromising measurement information.
%  \item The attacker can tamper measurements when they are collected from the fuel dispenser.
%  \item The attacker can tamper measurements informed by the vehicle.
% \end{itemize}

\section{Proposing a Supervision Framework}
In this section, we introduce the theoretical basis of our proposal.
We start from a model that describes a basic metrological supervision framework.
This framework exposes some problems related to the field surveillance of measuring instruments.
We then present a distributed and decentralized approach to implement a field surveillance framework by using measurements from inaccurate instruments and information technology tools.
In the following subsections, we describe all these steps in details.

\subsection{A basic Metrological Supervision Framework}
Be $\mathcal{V}=\{v_1, ..., v_n\}$ and $\mathcal{C}=\{c_1, ..., c_m\}$ the sets which represent vendors and consumers, respectively.
Vendors and consumers perform trade transactions $\mathcal{T}$ related to measured goods.
Each vendor $v_n$ can trade with different consumers, as so each consumer $c_m$ can trade with several vendors.

\begin{figure}[!t]
\centering
\includegraphics[width=.4\textwidth]{basicframe1}
\caption{A basic metrological supervision framework.}
\label{f:basicframe1}
\end{figure}

Any trade transaction of measured goods can involve a conflict of interests.
So we assume that, for each transaction $\mathcal{T}$, the respective vendor $v_n$ has a measuring instrument $\mathcal{M}_k$ which regulates the transaction by informing the correct measurement.
The measuring instrument $\mathcal{M}_k$ belongs to $v_n$ because he is the most interested party in concluding the transaction and make profits from it.
In practice, $\mathcal{M}_k$ works as a third party, which provides reliability to the transaction $\mathcal{T}$.
However, different factors can compromise $\mathcal{M}_k$'s precision and accuracy (e.g., defects, misbehavior, or even fraud attacks).
That is why legal metrology introduces the idea of \emph{metrological supervision}.

A basic supervision framework includes the role of a notified body $\mathcal{N}$ (Figure \ref{f:basicframe1}).
It is responsible for verifying each measuring instrument $\mathcal{M}_k$ following specific directives (e.g., periodic inspection).
One can say that $\mathcal{N}$ attests the correct behavior of $\mathcal{M}_k$.
He also is responsible for halting measuring instruments which do not satisfies precision and accuracy criteria, applying eventual penalties when it finds evidence of mismanagement or malicious behavior.

\subsection{The problem}
The described model gives an overview of how legal metrology implements basic supervision frameworks in different places.
However, this framework presents several drawbacks in practice.

First, it requires \textit{in loco} instrument inspection, which forces $\mathcal{N}$ to travel to $\mathcal{M}_k$'s deployment site.
This scenario becomes even more expensive when instruments are in remote places, or geographically spread.

Also, commercial transactions related to very profitable frauds can impose more challenging scenarios.
If $v_n$ or $c_m$ is a malicious entity, she can try to corrupt $\mathcal{N}$, offering bribes and convincing him to overlook inspection.
Furthermore, a modern $\mathcal{M}_k$ can be subject to sophisticated fraud mechanisms that implement stealthy malicious behavior.
Such attacks are harder to spot in conventional inspection procedures.

Different measures are taken to overcome such attacks.
That can involve physical sealing or tamper proof elements for protecting $\mathcal{M}_k$, or even inspection procedures that increase the difficulty of corrupting a metrological agent $\mathcal{N}$.
However, these alternatives can be ineffective when the undue advantages exceed substantially the costs associated with the attack implementation.
Thus we need a more suitable approach to deal with such problems.

\subsection{The Distributed and Decentralized Surveillance Framework (DDSF)}
We propose an extension of the basic supervision framework which deals with the problems discussed in the previous section.
This strategy consists of a distributed and decentralized data storage service $\mathcal{D}_s$ which keeps the record of any performed trade transaction and enables metrological field surveillance on the fly.
We glimpse a blockchain as the best alternative to implement this solution, which we name as \emph{Distributed and Decentralized Surveillance Framework} (DDSF).

We assume two necessary conditions for implementing DDSF:
\begin{enumerate}
 \item \textbf{There is a set of stakeholders interested in supporting the reliability of any trade transaction.} 
  This premise is very realistic. 
  Cheating trade transactions affect not only the directly involved parts (i.e., vendors and consumers).
  They also harm several other actors related to the business chain.
  That can include other vendors who have losses due to unfair competition, government agencies which need to worry about more restrictive supervision policies, notified bodies that have more efforts with inspection procedures, and the society in general once the trade relations are under suspicion.
 \item \textbf{Each consumer has a second measuring instrument $\mathcal{S}_l$ which gives a complementary estimative of measurement related to the traded good.} This requirement can sound a little complex at first as measuring instruments with high precision and accuracy are expensive.
 That is one of the main reasons why, in consumption relations, $\mathcal{M}_k$ usually belongs to a vendor $v_n$.
 However, a consumer $c_m$ usually want to be sure that $\mathcal{M}_k$ is measuring correctly.
 If $c_m$ has resources for using a measuring instrument $\mathcal{S}_l$ to verify $\mathcal{M}_k$, he likely will do that.
\end{enumerate}

Once such conditions are fulfilled, we can implement DDSF as follows.
Vendors and consumers send their measurements (given by $\mathcal{M}_k$ and $\mathcal{S}_l$ respectively) to the data storage service $\mathcal{D}_s$ (Figure \ref{f:basicframe2}).
Independent stakeholders maintain $\mathcal{D}_s$ collaboratively as a distributed service.
That assures $\mathcal{D}_s$ availability and integrity.
At the same time, the data storage can be read on anytime by any stakeholder interested in implementing metrological surveillance using statistical data analyses.
Surveillance is not an exclusive role for notified bodies anymore.
Surveillance becomes a decentralized and more effective process.

Notice that the described implementation depends on an open data storage service $\mathcal{D}_s$.
Although this approach introduces concerns about privacy, information availability is essential to widespread initiatives related to metrological supervision.

\begin{figure}[!t]
\centering
\includegraphics[width=.4\textwidth]{basicframe2}
\caption{The Distributed and Detrological Surveillance Framework (DDSF).}
\label{f:basicframe2}
\end{figure}

\subsection{How metrological uncertainty affects DDSF}
\label{s:uncertainty}
An important question emerges from the DDSF idea.
It is related to how much precise and accurate $\mathcal{S}_l$ must be.
In other words, the metrological uncertainty associated with $\mathcal{S}_l$ measurements implies how useful this information could be for implementing statistical data analyses.

Our hypothesis relies on the Law of Large Numbers (LLN) \cite{Evans2004}.
The LLN states that, in an experiment where the number of samples of a random variable (identically distributed) increases, their average converges strongly to their theoretical value.
We can apply such theorem to the $\mathcal{S}_l$ measurements.
Although $\mathcal{S}_l$ is by definition an instrument with a high uncertainty value, a large number of measurements must have an average which converges to the theoretical mean.
By assuming that $\mathcal{S}_l$ error is identically distributed around the real measured quantity, we have that enough large number of samples from $\mathcal{S}_l$ can be used to evaluate $\mathcal{M}_k$ reliability.
% \textbf{TO-DO: Texto do Luiz Tarelho apresentando a fundamentacao teorica para fiscalizacao usando multiplas medicoes com incerteza desconhecida}.

\section{Instantiating the DDSF with Fuel Dispensers and Blockchain}

\begin{figure*}[!t]
\centering
\includegraphics[width=.95\textwidth]{reg-free}
\caption{Comparing a) the regulated model and b) the free model}.
\label{f:reg-free}
\end{figure*}

\subsection{The system overview}
In this section, we instantiate the proposed DDSF to a real case which involves fuel measuring.
We glimpse a system for decentralized and distributed surveillance which uses vehicles as active sensors for providing information about fuel dispensers accuracy.
Fuel station owners and drivers represent vendors and consumers, respectively.
$\mathcal{M}_k$ correspond to a fuel dispenser with expected high accuracy and precision, and $\mathcal{S}_l$ is a vehicular measuring system whose accuracy and precision are unknown.
The data repository $\mathcal{D}_s$ is a blockchain held by independent stakeholders, which can include other fuel station owners, government agencies, notified bodies, and entities representing consumer's interests.
The blockchain $\mathcal{D}_s$ stores measurements records, which are the fuel measurements from fuel dispensers and vehicles, as so as any complementary information.
Authorized stakeholders can access such measurements and implement data analysis as smart contracts, contributing to surveillance in a comprehensive manner.

%We propose and evaluate such a system starting from a conceptual model which describes the main idea.
%After describing such a theoretical model, we can also discuss an attack model.
%The final solution is designed considering attacks and countermeasures.
Initially, we assume that each vehicle has a mechanism for estimating the fuel amount inside its fuel tank.
On each refueling, the difference between initial and final fuel quantities gives the refueling estimate, which corresponds to the $s_l$'s measurement.
Although this estimate is expected to be inaccurate, a large number of samples (see Section \ref{s:uncertainty}) from different vehicles and refilling events can be handy to point out eventual measuring errors or even frauds in fuel dispensers.

Different solution models can implement the described system.
We consider in this work two models which are conceptually different.
The first is based on rules which are imposed by a regulation authority, which obligates fuel station owners and drivers to send information to the system. We call it \emph{regulated model}.
The second model comes from the idea that correct fuel station owners and drivers have a strong motivation to cooperate with the system.
So we assume a scenario where they voluntarily inform their respective measurements.
We call that as \emph{free model}.
In the next sections, we describe and compare both models.

\subsubsection{The regulated model}
%Figure~\ref{f:reg-free}~a shows an initial model that partially depicts some ideas already proposed in the literature \cite{Beteto2016}.
% \begin{figure}[!t]
% \centering
% \includegraphics[width=.5\textwidth]{regulated}
% \caption{The Regulated Model}
% \label{f:regulated}
% \end{figure}
The regulated model comes from the assumption that both $\mathcal{M}_k$ and $s_l$ are obligated to inform the fuel measurement (and estimative) to the surveillance system.
Figure~\ref{f:reg-free}~a depicts the main associated ideas.
In the regulated model, the driver informs his vehicle's fuel measurement whenever a commercial transaction is committed.
After, the fuel vendor is responsible for sending the complete refuel measurement record to the blockchain network.
For preventing malicious vendors from sending only the fuel dispenser measurement, or even do not send any information, the regulated model introduces a trusted, tamper-proof, secure device (SD).
SD is responsible for collecting information from both traders.
After that, it commits the commercial transaction and stores the measurement record in the data repository.
One shall note that this idea is very similar to the solution proposed in \cite{Beteto2016}. 
The difference is that the regulated model adds the vehicle's fuel measurements.

The regulated model introduces advantages and drawbacks.
An advantage is that the SD can aggregate additional features for other regulatory bodies. 
For instance, the system can integrate tax payment surveillance once the SD manages prices and payment information \cite{Beteto2016}. 
On the other hand, solutions based on compulsory mechanisms tend to be more expensive.
It requires a complete infrastructure which includes the SD itself, a permanent communication link and fault-tolerant mechanisms for ensuring system availability and redundancy.
Also, the SD and the fuel dispensers belong to the same scope, which means that both devices are under control of the same entity.
If we assume that the fuel dispenser is under the attack of a malicious entity, we must accept that the SD is subject to the same class of attacks.
%At last, there will be exceptional cases when the vehicle can not inform any measure, or when the driver refuses to provide any information.
%Since the transaction commitment also depends on the vehicle estimate, the regulated model can create some difficulties in these cases.

\subsubsection{The free model}
\label{s:freemodel}
In contrast to the regulated model, we present the idea of a \emph{free model} (Figure~\ref{f:reg-free}~b).
Fundamentally, the difference is the way how drivers and fuel vendors interact with the surveillance system.
In the free model, drivers and fuel vendors are invited to contribute voluntarily.
This concept takes advantage of common sense that correct entities have a strong motivation against frauds.

The free model works as follows.
Firstly, the driver and vendor need to agree on a transaction ID to identify the refueling event. 
After that, they send their fuel measurement to the surveillance system in independent transactions linked by the same ID. 
%In turn, the blockchain network implements a smart contract and invokes it whenever two measurements with the same ID are received, or after a specific timeout.
The surveillance system consolidates both transactions, making the measurement record available to stakeholders.
This approach is more straightforward than in the regulated model.
However, it results in three distinct possible scenarios.
The best one is when the driver and vendor contribute to the system, sending their respective measurements.
The other scenarios occur when only one of the entities sends her measurement.
If only the vendor informs the fuel dispenser measurement, such information does not have a practical use because one does not have the vehicle measurement for comparing.
In turn, when only the driver informs the vehicle measurement, he also can tell the fuel dispenser measurement.
He knows this information once he asked the refuel and paid for it.
Although such measurement record would seem suspicious (i.e., the driver can cheat with the fuel dispenser measurement), it is yet useful for statistical analyses.

\subsection{Vehicle measurements and reliability}
The proposed surveillance system depends on the gathering of measurements from both fuel dispensers and vehicles.
One can do that in different manners, according to the employed technology.
In turn, the selected technology impacts information reliability.
Even in cases when there are no frauds, information can be compromised due to the information gathering method.

One can expect that modern fuel dispensers provide very precise and accurate measurements.
Some fuel dispenser models also include features for increasing security (e.g., pulsers can provide the measurement's digital signature).
Besides, fuel dispensers also present a high automation level.
They commonly integrate with payment or data gathering systems.
Thus we can assume that the measurements provided for a non-malicious fuel vendor are highly reliable.

That does not happen with vehicles embedded measuring instruments.
In the majority of cases, the accuracy and precision of such instruments are unknown.
The chosen gathering method also impacts on those properties.
We identify at least three different levels of reliability, according to the employed gathering methods.
We describe them as follows:
\begin{enumerate}
 \item \textbf{User level.} The user does the measurement gathering. 
  Essentially, the driver checks the measurement (e.g., a fuel level gauge or a display in the vehicle panel) and informs it to the surveillance system. 
  This method has serious implications related to accuracy and reliability.
  For instance, a measurement from an analogical gauge is very imprecise and even hard to read.
  Even a non-malicious driver can inform a wrong measurement unintentionally.
  That is the less reliable level of a collected measurement.
  \item \textbf{Middleware level.} The vehicle has an interface that enables the measurement gathering.
  In this level, the user interaction is not necessary.
  A middleware gathers measurements from the vehicle's embedded computer using specific protocols and sends them to the surveillance system.
  Although reading errors become negligible, the measurement reliability yet depends on the middleware features.
  One can adopt different security strategies for assuring measurements integrity and authenticity.
  However, these solutions increase the system complexity.
  We classify that as a quasi-reliable method.
  \item \textbf{Fully integrate level}: The vehicle has a smart sensor into its fuel tank.
  The sensor delivers a fair, accurate measurement directly to system surveillance.
  There is no need for interaction with the vehicle's embedded computer either with the user.
  Furthermore, the sensor can use cryptographic mechanisms for assuring the measurement integrity and authenticity.
  %The sensor can even format the blockchain transaction, working as an oracle.
  This gathering method is the most reliable.
  However, it also implies a not simple solution.
  There are costs associated with the smart sensor acquisition, deployment, and eventual maintaining.
\end{enumerate}

% \subsection{Metrological assurance}
% \textbf{TO-DO: Texto do Luiz Tarelho descrevendo as condicoes teoricas que devem ser satisfeitas para que os dados de abastecimento do veiculo possam ser uteis na identificacao de eventuais fraudes.
% }
% \subsection{Cyber-physical security}
% \textbf{TO-DO: Texto do Wilson argumentando como a seguranca ciber fisica do sistema e obtida.
% Devem ser enfatizados os aspectos de seguranca intrinsecos ao blockchain e tambem os casos que justificam a autenticacao baseada em contexto fisico entre veiculo e bomba de combustivel.
% }

\section{Security analysis}
\subsection{Identifying attackers and goals}
In a typical scenario involving vehicles and fuel dispensers, we assume that an attacker's primary objective is to get undue economic advantages.
He does that by tampering with fuel measurements.
Initially, one can consider suspicious any one of the parts involved in the commercial transaction.
However, in a simplified manner, we identify malicious drivers and fuel vendors as potential attackers.
Malicious fuel vendors take advantage of cases when the fuel measurement is higher than the correct value.
On the other hand, a fuel measurement lower than the correct amount benefits malicious drivers.
Also, a scenario including a surveillance system (i.e., a system that evaluates the accuracy and correct behavior of fuel dispensers) introduces a second attack goal: the intention of compromising this system.
For instance, malicious drivers can target the surveillance system, aiming to create false suspicions about a fuel dispenser to harm its owner.

Regarding attack capabilities, a malicious fuel vendor is supposed to be more resourceful than a malicious driver. 
That happens because he is the formal owner of the devices used in the commercial transaction (e.g., fuel dispenser, payment systems).
The fuel vendor can control and modify these devices features, compromising the accuracy of the measurements.
Besides, fuel measurement frauds are very profitable for malicious vendors.
That motivates the conception of sophisticated attacks involving different fraud strategies. 
Malicious drivers also can tamper with measurements.
However, they are limited when compared to fuel vendors.
Although the driver has total control over the vehicle measuring system, the fuel dispenser controls the commercial transaction.
Any tampered measurement coming from the vehicle does not result in economic advantages.
One can consider exceptional cases where the driver can hack fuel dispensers or payment systems.
However, reports of similar practice are very uncommon, and we remove it from our analysis.

Attacks targeting the surveillance system require some specific resources.
We foresee two basic strategies: a) the attacker provides incorrect information in a manner that the surveillance system does not detect the measurement frauds and b) the attacker compromises the surveillance system by tampering with the stored measurements.
Both strategies depend on collusion among fuel vendors, drivers, and even other stakeholders.
Collusion attacks are typically expensive.
Also, these attacks would result in economic advantages only for fuel vendors.
That reduces the incentives for malicious drivers to take part in the collusion.
However, a possible attack approach is to generate false refueling events.
For instance, a malicious driver can forge several measurements, creating fake refuel events.
After, he sends the information to the surveillance system, claiming that the fuel station did not report the event.

\subsection{Countermeasures}
We claim that the DDSF offers natural protection against several scenarios related to the described attacks.
One can observe different advantages and drawbacks when comparing the regulated and free models.
We show that by evaluating the security features provided by each model in four main attack classes: measurement tampering, information denying, information forging, and collusion.

\subsubsection{Measuring tampering}
Both the regulated and free models try to detect frauds by counterposing measurements from the fuel vendor and the driver.
However, the regulated model depends on SD integrity and reliability.
If an attacker compromises SD, any collected measurement can be modified and tampered without any chance of detection.

One conceives the SD as a tamper-proofing device.
Consequently, any tentative of violating it is expected to be exposed.
However, we remember that legal metrology already enforces mechanisms for protecting fuel dispensers' integrity and ensuring their reliability.
Nevertheless, the high number of cases reporting metrological frauds in fuel dispensers shows that this assumption can fail.
The main problem is that the fuel dispenser is under the control of a fuel vendor who can modify its behavior.
One must admit that the same can happen with SD.
Malicious fuel vendors can compromise SD integrity as so as they do with fuel dispensers.

On the other hand, the free model is robust against such attacks because it does not require any intermediate device for processing information before sending it to DDSF.
Although attackers can yet tamper with measurements, such practice may be exposed later by analyzing data in the blockchain using statistical tools.

\subsubsection{Information Denying}
Information denying occurs when either the fuel vendor or the driver decides to omit information about a trading transaction.
The regulated model does not allow this class of attacks once the SD forces driver and fuel vendor to provide their measurements before committing any trading transaction.
There are some particular cases when the driver does not have any instrument for providing measurements.
In these cases, the driver shall agree with the fuel dispenser measurement and the trading transaction is considered correct.
Also, we have scenarios where a compromised SD omits the measurement informed by the driver.
However, we consider such cases as a variant of the first class of attacks.

In contrast, this attack can be widespread and even stealthy in the free model.
Malicious fuel vendors can omit information purposely for hiding a fraudulent trading transaction.
In turn, drivers do not have any advantage in omitting information.
Notwithstanding,  they eventually may not have the necessary resources to do that, or they can decide not to contribute to the system.
Such choices are intrinsic to the nature of the free model.

Although information denying is supposed to be quite common in the free model, there is a practical manner of dealing with it: DDSF can consider as suspicious any transaction informed only by the driver.
That is a practical approach since fuel vendors are expected to have plenty of resources to send their information to the system.
However, that also introduces a new class of attacks, which consists in the possibility of an attacker to forge false transactions.

\subsubsection{Information forging}
Information forging happens when the attacker creates information about a false trading transaction.
Primarily, this kind of attack aims to compromise DDSF credibility.
Information from transactions that did not happen can affect the statistical analysis and hazard DDSF efficiency.

In the regulated model, such attacks can be launched only by malicious fuel vendors because they require a compromised SD.
Also, we can not identify any advantage for fuel vendors in such attacks.
If a fuel vendor simulates a trading transaction, he does not harm any consumer.
In opposite, he can have problems with other authorities that can investigate if the amount of trading fuel corresponds to the amount of paid taxes.

In the free model, both the fuel vendor and driver can try such attacks.
How we argue before, fuel vendors do not have any advantage in doing that.
But drivers can try such attack aiming to spoil DDSF or even for harming the reputation of a correct fuel vendor.
The question is that an attack launched by only one driver is not enough to affect statistical analyses.
Also, we can easily spot transactions forged by the same driver, once they have the same user identification.
That invalidates the possibilities for a regular driver to undertake such attacks.

Finally, we consider one last possibility in the free model.
A resourceful attacker can personify different drivers by creating fake profiles or even stealing legitimate drivers identification.
Despite its chances of success, this attack is remarkably costly.
Also, we understand that such problem is related to the security of the system which assigns drivers' credentials.
Countermeasures can include the analysis of drivers behavior and the existence of a legal process for accepting drivers who want to join DDSF.

\subsubsection{Collusion attacks}
Collusion attacks are usually frequent in the context of fuel trading transactions.
The main reason is fraud profitability.
Malicious fuel vendors can offer bribes to notified bodies and other legal authorities.
Groups of malicious vendors can even form cartels that control fuel prices and disseminate measurement frauds in large scale.
That is an admittedly tricky problem, whose the solution is not trivial.

Collusion attacks can occur in both regulated and free model.
However, there is an important difference.
In the regulated model, collusion can be used to commit frauds before and after the SD sends the measurement to the blockchain.
Collusion before sending information incurs in the same attacks already described for the SD.
The essential difference is that notified bodies or any other authorities taking part in the collusion consent with such attacks.
In contrast, collusion attacks in the free model only make sense after driver and fuel vendor sending their respective measurements.
Consequently, any collusion attack takes place against the blockchain.
The good news is that, in this context, blockchains play a crucial role against collusion attacks.

Blockchains work as a genuine distributed and decentralized data storage system.
That significantly reduces the possibility of a specific entity to take control of the network peers majority. %evidence database???
In a permissioned blockchain, the consensus decision is reached by a quorum of peers that belongs to independent organizations which are interested in fighting against frauds.
That forces an attacker to have the control of a significant part of the peers that integrate the quorum, and consequently to form collusion with a significant number of people and organizations.
The more organizations participate in the consensus quorum, the more expensive the attack becomes.
Furthermore, blockchains constitute an append-only data storage architecture.
Once any information is stored, it is virtually impossible to modify or remove it.
That makes blockchains a unique technology for storing information used to detect and prevent measurement frauds.
Also, the extensive use of cryptographic features assures information authenticity and integrity.

% False suspicions usually impact much more fuel vendors than drivers.
% They can harm the reputation of a correct fuel vendor, besides result in wasting inspection resources.
% 
% We can use the text about capabilities later.
% 
% Considering all the aspects above, we define that a malicious fuel vendor has following attack capabilities:
% - The vendor can compromise the fuel dispenser measuring mechanism. That includes changing components (e.g., mechanical, electronics and software).
% - The vendor can tamper with measurements after collecting them from the fuel dispenser.
% - The vendor can compromise any middleware or management system (e.g., payment system). That implies to tamper with measurements from both vehicle and fuel dispenser.
% - The vendor can provide tampered information to the surveillance system.
% - The vendor can collude with other stakeholders to compromise the surveillance system integrity.
% 
% In complement, we define that a malicious driver has the following attack capabilities:
% - The driver can compromise the vehicle's measuring mechanism.
% - The driver can tamper with measurements

\section{Case Study: Implementing the DDSF for a realistic demand}
In this section, we develop a case study that uses Hyperledger Fabric to implement the proposed DDSF free model.
Our solution stores measurements from fuel dispensers and vehicle meters, and implements a simple fraud detection heuristic using smart contracts.
%, which permits to identify some fuel dispensers fraudulent behavior.
Besides, we simulate the behavior of fuel dispensers and vehicles by using metrological field surveillance data from the National Institute of Metrology, Quality, and Technology (Inmetro\footnote{Inmetro is the Brazilian NMI (National Metrology Institute) responsible for measuring instruments type approval, market and field surveillance.}).

We consider that our implementation needs to meet the demand of vehicles refueling in Sao Paulo state, Brazil.
Sao Paulo is the biggest federated state in Brazil, with a population of approximately 45 million people and a vehicular fleet of 30 million vehicles.
These numbers are expressive in demonstrating that we can compare Sao Paulo with countries like the United Kingdom, Mexico, and Spain, in terms of the number of vehicles.

\begin{table}[t!]
\centering
\caption{Statistical description of inspection data used to simulate the fuel dispenser error. The functinos $m(err)$ and $std(err)$ are the mean and the standard deviation, respectively.}
\label{t:dataset}
\begin{tabular}{|l|c|c|c|}
\hline
\textbf{}                                  & \multicolumn{1}{l|}{\textbf{number}} & \multicolumn{1}{l|}{\textbf{$m(err)$}} & \multicolumn{1}{l|}{\textbf{$std(err)$}} \\ \hline
Inspected instruments              & 187,849                                      & 9,7                                    & 48.3                                     \\ \hline
Inst. with error \textgreater 200 ml & 111                                          & 417.4                                  & 398.9                                    \\ \hline
\end{tabular}
\end{table}

In 2015, Sao Paulo had a total 8,849 fuel stations \cite{Beteto2016}.
By assuming that each fuel station can manage one refuel event per minute (i.e., the driver needs to park the vehicle, insert the fuel nozzle in the respective place, refuel the vehicle tank, and finally remove the vehicle before releasing the fuel dispenser to the next driver), we can affirm that all the fuel stations in Sao Paulo state can manage a demand of no more than 150 refuel events per second.
Since our experiment implements the DDSF free model, we have that each refuel event generates two transactions, and we can estimate a demand of 300 tps.

\subsection{Data simulation}
%TODO: ACRESCENTAR DADOS DE FISCALIZAO DO INMETRO
We start our experiment by simulating random refuel events.
Each event has its respective measurements from the fuel dispenser and the \emph{vehicle's fuel meter} (VFM).
Both measurements are subject to a statistical error.
We model the fuel dispenser error by using data from field surveillance inspections done in 2017.
Regarding the VFM, we assume that its error is random and uniformly distributed in a range between $-v_{Err}$ and $+v_{Err}$, being $v_{Err}$ the measurement error associated with the VFM uncertainty.

Table \ref{t:dataset} summarizes the data used to simulate the fuel dispenser error for correct and tampered instruments.
We take data from 187,849 periodic inspections of fuel dispensers.
An inspection procedure consists in measuring a standard refuel of 20 liters and comparing the measured value with the reference value.
In Brazil, the fuel dispensers regulation\footnote{http://www.inmetro.gov.br/legislacao/rtac/pdf/RTAC002514.pdf} defines the permissible error between -100 and 50 ml (in 20 liters).
In the set of inspected instruments, the measurement error has a mean of 9.7 ml and a standard deviation of 48.3 ml.
We use this information to simulate fuel dispensers that are supposed to inform correct measurements.
A total of 8,857 fuel dispensers exceed the limits of error.
However, we are interested in instruments whose the measurement error could be indicative of fraudulent behavior.
So we consider in our simulation only the cases where the error is higher than 200 ml.
This group corresponds to 111 fuel dispensers.
In this group, the measurement error presents a mean of 417.4 ml, and its standard deviation is 398.9 ml.
We use this information to simulate fuel dispensers that are supposed to be tampering with the measurements.
There is a point here that calls our attention.
The percentage of instruments considered as suspicious of fraudulent behavior is remarkably low.
However, we have reasons to suppose that the percent of fraud cases is higher than that.
The available inspection data comes from periodic inspections, which correspond to situations where the notified body plans the inspection, and the fuel station responsible knows about it.
Under these circumstances, many malicious vendors modify tampered instruments before the inspection, removing any evidence of fraud \cite{Leitao2014a,Beteto2016}.

Our simulation generates refilling events by considering scenarios with different numbers of vehicles and fuel dispensers.
In each scenario, we assign a different measurement uncertainty to the VFM.
We also assume different tampered fuel dispensers percentages.
%Our method accuracy is sensitive to these values.
A high number of tampered fuel dispensers increases false positives and false negatives rates.
The same thing happens when the VFM has high uncertainty.

We use the simulated refuel events to submit transactions to the blockchain.
We assume that both fuel dispensers and vehicles inform their measurements in different transactions, following the DDSF free model idea.
Every time a transaction is complete (i.e., the blockchain receive both the expected measurements), the respective smart contract starts a statistical analysis that we describe in the next sections.

\subsection{The Blockchain Implementation}
We use HyperLedger Fabric 1.1\footnote{https://hyperledger-fabric.readthedocs.io/en/release-1.1/} in our experiment.
We develop a blockchain network where organizations representing stakeholders cooperates with the DDSF solution.
Each organization provides a corresponding number of peers that constitutes the blockchain network.
Some organizations also take part in the \textit{orderer consortium} (i.e., a group of peers that performs the blockchain consensus using BFT protocols).
We make use of the BFT orderer described in \cite{Sousa2018}.

\begin{figure}[!t]
\centering
\includegraphics[width=.4\textwidth]{fbn}
\caption{The proposed blockchain architecture.}
\label{f:fbn}
\end{figure}

Figure \ref{f:fbn} depicts our blockchain architecture. 
We consider two independent organizations (LaSIGE and Inmetro) providing each one a set of 4 ordinary peers and two consensus peers.
The DDSF follows the \emph{free model} idea described in the Section \ref{s:freemodel}.
The blockchain network accepts transactions from clients who are essentially vendors (i.e., fuel station owners) or consumers (i.e., drivers).
We assume that every refuel event generates a unique event ID (e.g., the fuel dispenser can exhibit a QR Code).
Both clients use this ID to identify their transaction and send their measurements to the blockchain-based DDSF.
Thus clients proceed according to the steps described to the DDSF free model.

We do not specify how fuel vendors send their transactions to the blockchain.
One shall consider that fuel dispenser are instruments which already include resources to communicate and generate transactions.
On the other hand, the way how consumers can contribute to DDSF is crucial.
They need to do it in a natural, practical way.
So we assume the existence of a client (e.g., a smartphone app) which drivers can use to submit their transactions easily.
The app can work in three different modes which correspond to the reliability levels described previously.
The consumer can choose one of them, following his interest in helping against measurement frauds.
These modes are:
\begin{itemize}
 \item \textbf{Informative:} the driver types the measurement informed by the fuel dispenser and also the measurement provided by his vehicle fuel gauge/panel. This mode does not imply any cost to the consumer. However, it is very imprecise and subject to measurement and typing errors.
 \item \textbf{Measured by the vehicle system:} the app connects to the vehicle (i.e., by using Bluetooth or OBD technologies) and gets the fuel amount estimative provided by the vehicle's embedded computer. This mode can require an OBD adaptor (in case of the vehicle does not offer a Bluetooth interface) and perhaps some specialized training (or service) to configure the app.
 \item \textbf{Measured by smart sensors:} the app connects to a smart sensor installed into the vehicle's fuel tank. The smart sensor provides highly accurate measurement and can also sign such information, attesting to its authenticity. This mode is the most expensive one, and its deployment usually requires specialized service.
\end{itemize}

\subsection{Analysis Heuristic}
Our experiment implements a statistical analysis based on the Law of the Large Numbers (LLN) that estimates the VFM measurement uncertainty and uses it to detect events that we can consider as outliers.
We implement this analysis heuristic as a smart contract in Fabric, using Go language.

\begin{figure*}[!t]
\centering
\includegraphics[width=.9\textwidth]{lln}
\caption{Graphics showing sensibility and specificity rates in the tests round \#1 (modifying $E$), round \#2 (modifying $D_f$), and round \#3 (modifying $v_{Err}$, respectively.}
\label{f:lln}
\end{figure*}

%Firstly, we assume all the fuel dispensers as reliable, accurate and precise instruments.
For each refuel event $n$ involving a vehicle $l$ with a VFM $\mu_{\mathcal{S}_l}$, and a fuel station $k$ with its respective fuel dispenser $\mathcal{M}_k$, we update the VFM uncertainty estimate $\mu_{\mathcal{S}_l}$ by using the measurements $m_(\mathcal{M}_k,n)$ and $m_(\mathcal{M}_k,n)$, according to the equation:
\begin{equation}
    \mu_{\mathcal{S}_l}(n) = \frac {(n - 1) * \mu_{\mathcal{S}_l}(n - 1) + m(\mathcal{M}_k,n) - m(\mathcal{S}_l)}{n}
\end{equation}
After a sufficient number of samples, the VFM estimate uncertainty $\mu_{\mathcal{S}_l}$ converges to the correct VFM uncertainty value (due to the LLN).
The more events we compute, the more precise the uncertainty estimate is.

When the uncertainty estimate becomes a stable value (i.e., new refuel events change the uncertainty estimate in a negligible correction), we can use it to detect outliers.
We mark every outlier event in the blockchain as a case of suspicious measurement.
%For each new refilling event, we can also update the vehicle's measuring instrument uncertainty.
%After we start our \emph{first level inspection}, which consists in detecting refilling events "outliers" by using the uncertainty estimate.
We consider as outlier any refuel event where the difference between the fuel dispenser measurement and the VFM measurement (i.e., the measurement uncertainty estimate) satisfies the following inequation:
\begin{equation} \left| m(\mathcal{M}_k,n) - m(\mathcal{S}_l,n) \right| > K_1 * \mu_{\mathcal{S}_l}(n) \end{equation}
where $K_1$ correspond to a dispersion constant to determine outlier events.

Once we have the outliers list, we implement a second level analysis based on the same idea used to detect event outliers.
If a fuel dispenser is related to a significant number of suspicious events (i.e., it is a frequency outlier), we consider it as a possible tampered instrument.
We decided that by using the frequency information in the outliers list.
Be $F = \{f_{\mathcal{M}_1},f_{\mathcal{M}_2},...,f_{\mathcal{M}_k}\}$ the set with the frequencies which count the number of suspicious events related to each fuel dispenser $\mathcal{M}_k$, the decision about if $\mathcal{M}_k$ is a possible tampered instrument is given by:
\begin{equation} f_{\mathcal{M}_k} > mean(F) + K_2 * std(F) \end{equation}
where $mean(F)$ and $std(F)$ are respectively the mean and the standard deviation of the values in $F$ and $K_2$ correspond to a dispersion constant to determine outlier frequencies.

% the mean and the standard deviation of the refilling events.
% We then insert the fuel dispensers associated with these events in a suspicion list.
% The second level analysis collects the suspicion list of each vehicle and computes the total of suspicion occurrences of each fuel dispenser.
% Again, we use the mean and the standard deviation of the suspicion list, but now discarding outliers and considering the more frequent fuel dispensers as suspicious of fraud.
%The code runs as a smart contract in a blockchain-based DDSF.
%We describe our blockchain architecture in the next section.

\subsection{Experimental evaluation}
Before presenting our experiment results, we need to discuss some specific parameters which are relevant to our analysis:
\begin{itemize}
    \item $E$ is the number of refuel events, i.e., the number of simulated samples of measurements pairs (fuel dispenser and VFM measurements)
    \item $D$ is the number of distinct fuel dispensers.
    \item $D_f$ is the percent of fuel dispensers simulated as tampered instruments.
    \item $V$ is the number of distinct vehicles (and consequently, distinct VFM).
    \item $v_{Err}$ is the VFM measurement error limit value.
\end{itemize}

The parameter $E$ impacts directly on results because it determines the LLN applicability in our study.
The parameters $D$ and $V$ have an essential influence on the results, once they determine the proportion between fuel dispensers and vehicles.
Lastly, $D_f$ and $v_{Err}$ are crucial because they establish the universe of tampered instruments as so as the VFM's necessary accuracy to exploit the fraudulent behavior.

We organize our experiment in three rounds.
On each round, we vary one specific parameter of interest and fix the others.
We modify the parameter of interest in a determined range, by assigning individual values.
For each value, we execute 100 consecutive simulations and calculate the \emph{specificity} and \emph{sensibility} statistic measures that result from the application of our analysis heuristic.

The graphics at Figure \ref{f:lln} shows the specificity and sensibility of each experiment round.
We discuss each one of them in the following subsections:

\subsubsection{Round \#1: modifying $E$}
The results demonstrate how the number of events affects our analysis and the convergence properties of the LLN.
The sensibility presents poor measures at the beginning and increases significantly after 5,000 events (or samples).
The other parameters are fixed with the values: $D = 100$, $D_f = 5\%$, $V = 1000$, and $v_{Err} = 5\%$.

\subsubsection{Round \#2: modifying $D_f$}
The results seem to indicate that the analysis is robust with different percents of tampered fuel dispensers.
Although specificity is slightly compromised when we have a low percent of frauds (which increases the number of false positive cases), our analysis heuristic presents a good performance.
We obtain the best trade-off when considering a rate of 7\% of tampered fuel dispensers.
The other parameters are fixed with the values: $E = 10000$, $D = 100$, $V = 1000$, and $v_{Err} = 5\%$.

\subsubsection{Round \#3: modifying $v_{Err}$}
The value of $v_{Err}$ is related to the VFM accuracy and impacts directly the sensibility of the method.
One can see that sensibility decreases fast when $v_{Err} > 5\%$.
Instruments with lower accuracy will require a larger number of measurements to present some useful result.
However, as we discussed in Section \ref{s:freemodel}, the assumption of $v_{Err} \leq 5\%$ is very realistic.
The other parameters are fixed with the values: $E = 10000$, $D = 100$, $D_f = 5\%$, and $V = 1000$.

After checking these results, we can affirm that our statistic heuristic used to detect tampered fuel dispensers performs fairly enough.
However, as expected, it requires a significant number of refuel events samples.
We get our best trade-off when considering a minimal of 10,000 samples from 1,000 distinct vehicles.
This result implies that each vehicle refuels an average of 10 times.
This number is quite realistic in terms of practical implementations.
Considering that a driver refuels his vehicle once or twice a week, a real-world application would collect the required amount of samples in less than two months.

\subsection{Blockchain performance}
We also evaluate the blockchain performance, by following the same test methodology used in \cite{MeloJr.2019}.
We generate a workload of concurrent clients that simulates transactions from fuel vendors and drivers.
The client instances try to send transactions continually, while we evaluate the blockchain performance in terms of latency (in seconds) and throughput (in transactions per second -- tps).
Figure \ref{f:performance} shows our findings.
The throughput rate increases until we reach a workload of 600 concurrent clients.
From this point, throughput decreases slightly while latency increases.

The best trade-off points out a throughput of 400 tps to the proposed network configuration.
We understand that such performance meets the demanded of 300 tps previously associated with the refuel events in Sao Paulo state.
So we consider this a satisfactory result.
An important aspect is that the proposed network infrastructure is not expensive.
Furthermore, other peers could be easily added to the solution to address specific issues related to the smart contract execution, once Fabric uses the concept of endorsers to do that.
We recommend the work of Androulaki et al. \cite{Androulaki2018} for more details about Fabric performance.

\begin{figure}[!t]
\centering
\includegraphics[width=.4\textwidth]{performance}
\caption{Performance results in terms of transactions throughput and latency.}
\label{f:performance}
\end{figure}

\subsection{Discussions}
After evaluating the results from our experiment, we conclude this section with the discussion of some questions that are quite relevant in a real-world implementation.

%We consider that our initial results are meaningful.
We demonstrate the possibility of a practical field surveillance practice by using innovative tools and concepts from information technology.
It is important to realize that our experiment simulates tampered fuel dispensers with a particular behavior.
We assume that malicious instruments generate tampered measurements every time.
In practice, the behavior of a compromised fuel dispenser can be more stealthy.
For instance, a malicious vendor can activate and deactivate an electronic fraud on a fuel dispenser in a specific schedule (e.g., frauds are active on the weekends because there are more drivers and low probability of inspections).
However, we do not see this issue as a drawnback in our solution.
In our implementation, we used an elementary statistical analysis that presented satisfactory results.
On the other hand, since we store the measurements in a distributed and decentralized ledger, any authorized stakeholder can implement more sophisticated smart contracts to proceed with different surveillance strategies.
Thus we understand that different particular cases of malicious behavior can be adequately addressed by using specific surveillance strategies.
Our idea introduces several new possibilities to detect and prevent frauds in measuring instruments.

The case study related to the field surveillance of fuel dispensers is also important.
This case illustrates how to make use of the stronger points of a blockchain-based solution.
We have a scenario that motivates all the actors to actively take part in the surveillance by providing information to the DDSF.
Drivers want to contribute because frauds impact directly on their money.
Vendors want to contribute because unfair concurrency is harmful to the business.

We also emphasize that one of the main merits of our idea is its low-cost implementation.
As we discussed previously, the use of an app by drivers and the acquisition of devices to interface with the vehicle are affordable.
We also demonstrate that a blockchain network composed of few machines is enough to support the demand related to a large fleet of vehicles, as is the case of Sao Paulo state in Brazil.
Besides, the use of smart contracts to implement surveillance strategies is very simple and improves transparency.

Finally, we claim that our approach meets the main tendencies in the legal metrology area which relies on the use of new technologies.
We justify by comparing the DDSF strategy with the Metrology Cloud initiative from Europe Union.
The Metrology Cloud emerges from the idea that information must be available as soon as possible to improve decision making.
At the same time, information security is one of the main concerns about sending measurements from different instruments to the cloud.
We understand that blockchains provide natural design features to deal with these requirements.
More than that, blockchains can address scenarios where stakeholders cannot find a reliable third party.
That is a real condition in several scenarios involving legal metrology in developing countries.

\section{Conclusion}
In this paper, we presented a practical idea to implement the metrological surveillance of fuel dispensers using a blockchain-based distributed and decentralized solution.
We described all the steps in the conception of our DDSF free model, that takes advantage of the blockchains to store measurements reliably while enables surveillance practices by using smart contracts.
The results from our case study attest that our idea is feasible.

% One of the main merits of our idea is its low-cost implementation.
% How we discussed previously, the use of an app by drivers and the acquisition of devices to interface with the vehicle are affordable.
% We also demonstrate that a blockchain network composed of few machines is enough to support the demand related to a large fleet of vehicles, as is the case of Sao Paulo state in Brazil.
% Besides, the use of smart contracts to implement surveillance strategies is very intuitive.
% In our implementation, we used an elementary statistical analysis that presented satisfactory results.
% However, since we store the measurements in a distributed and decentralized ledger, any authorized stakeholder can implement more sophisticated smart contracts to proceed with different surveillance strategies.
% Our idea introduces several new possibilities to detect and prevent frauds in measuring instruments.

The next steps in our work are the creation of a complete prototype for drivers in Brazil and the development of more sophisticated analysis to proceed with field surveillance.
These ideas also include the development of an app for smartphones, and the specification of devices able to interface with the vehicles by using the OBD standard.

\bibliographystyle{ACM-Reference-Format}
\bibliography{fuel} 

\end{document}
